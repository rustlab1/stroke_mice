---
title: "Path_to_answers"
output: html_document
date: "2025-08-03"
---

Note: Before running this script, please run stroke_immunodef.Rmd and make sure all necessary datasets (e.g., counts, res, gsea_go) are loaded into the environment.

```{r}
# 1  "What is the GC content percentage in sample WT_Ctrl_1?"
# Taken from QC files in shell 
gc_content <- 49
paste0(gc_content, "%")
```

```{r}
# 2 "What percentage of reads from sample WT_Stroke_1 map uniquely to the mm10 reference genome?"
# Taken from `samtools flagstat`
mapping_percent <- 96.36
paste0(mapping_percent, "%")
```


```{r}

# 3) What percentage of expressed genes in sample WT_Stroke_1 are mitochondrial (gene symbols starting with 'mt-')?

# Assuming 'counts' is already loaded and has gene symbols as rownames
# Expressed genes: nonzero counts
expressed_genes <- rownames(counts)[counts$WT_Stroke_1 > 0]

# Mitochondrial genes start with "mt-"
mt_genes <- grep("^mt-", expressed_genes, value = TRUE, ignore.case = TRUE)

# Calculate percent
mt_percent <- round(length(mt_genes) / length(expressed_genes) * 100, 2)
paste0(mt_percent, "% (", length(mt_genes), "/", length(expressed_genes), ")")


```



```{r}
# 4) "Which gene is most upregulated after stroke, based on fold change?"

# Convert DESeq2 results to dataframe and add gene names
res_df <- as.data.frame(res)
res_df$Gene <- rownames(res_df)

# Sort by log2 fold change descending
res_sorted <- res_df[order(-res_df$log2FoldChange), ]

# View the top upregulated gene
head(res_sorted[, c("Gene", "log2FoldChange", "padj")], 1)$Gene


```


```{r}

# 5) "Which pathway has the highest normalized enrichment score (NES)?"
# Convert GSEA result to a dataframe
gsea_df <- as.data.frame(gsea_go)

# Calculate GeneRatio (from core_enrichment / setSize)
gsea_df <- gsea_df %>%
  mutate(
    gene_ratio = sapply(core_enrichment, function(x) length(unlist(strsplit(x, "/|;")))) / setSize
  )

# Sort by gene ratio
gsea_df <- gsea_df %>% arrange(desc(NES))

# Show top GO term by gene ratio
gsea_df[1, c("ID", "Description", "gene_ratio", "NES", "p.adjust")]

```

